// Bun Snapshot v1, https://bun.sh/docs/test/snapshots

exports[`UnifiedWorkflowGenerator should generate consistent workflow output (snapshot) 1`] = `
"name: AI Agents
"on":
  issues:
    types:
      - labeled
      - opened
  pull_request:
    types:
      - opened
  workflow_dispatch:
    inputs:
      agent:
        description: Specific agent to run (leave empty to auto-route)
        required: false
        type: string
permissions:
  actions: write
  contents: read
  issues: write
  pull-requests: write
jobs:
  global-preflight:
    runs-on: ubuntu-latest
    outputs:
      should-continue: \${{ steps.validate.outputs.should-continue }}
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - name: Validate Claude authentication
        id: validate
        run: bun run repo-agent run setup:preflight
        env:
          ANTHROPIC_API_KEY: \${{ secrets.ANTHROPIC_API_KEY }}

  dispatcher:
    runs-on: ubuntu-latest
    needs: global-preflight
    if: needs.global-preflight.outputs.should-continue == 'true'
    outputs:
      agent-test-agent-should-run: \${{ steps.dispatcher.outputs.agent-test-agent-should-run }}
      agent-test-agent-skip-reason: \${{ steps.dispatcher.outputs.agent-test-agent-skip-reason }}
      agent-test-agent-event-payload: \${{ steps.dispatcher.outputs.agent-test-agent-event-payload }}
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - name: Dispatch agents
        id: dispatcher
        run: bun run repo-agent run dispatcher
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
          WORKFLOW_DISPATCH_AGENT: \${{ inputs.agent }}

  agent-test-agent:
    runs-on: ubuntu-latest
    needs:
      - global-preflight
      - dispatcher
    if: needs.dispatcher.outputs.agent-test-agent-should-run == 'true'
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - uses: actions/create-github-app-token@v1
        id: app-token
        with:
          app-id: \${{ secrets.GH_APP_ID }}
          private-key: \${{ secrets.GH_APP_PRIVATE_KEY }}
        continue-on-error: true
      - name: Configure git identity
        run: |-
          git config --global user.name "\${{ steps.app-token.outputs.app-slug || 'github-actions[bot]' }}"
          git config --global user.email "\${{ steps.app-token.outputs.app-slug || 'github-actions[bot]' }}@users.noreply.github.com"
      - name: Run Test Agent
        run: bun run repo-agent run agent --agent "Test Agent"
        env:
          GH_TOKEN: \${{ steps.app-token.outputs.token || secrets.GITHUB_TOKEN }}
          ANTHROPIC_API_KEY: \${{ secrets.ANTHROPIC_API_KEY }}
          EVENT_PAYLOAD: \${{ needs.dispatcher.outputs.agent-test-agent-event-payload }}
      - name: Upload outputs
        uses: actions/upload-artifact@v4
        with:
          name: agent-test-agent-outputs-\${{ github.run_id }}
          path: /tmp/outputs/
          retention-days: "7"
      - if: always()
        name: Upload audit metrics
        uses: actions/upload-artifact@v4
        with:
          name: agent-test-agent-audit-\${{ github.run_id }}
          path: /tmp/audit/
          retention-days: "7"

  agent-test-agent-outputs:
    runs-on: ubuntu-latest
    needs:
      - agent-test-agent
    if: needs.agent-test-agent.result == 'success'
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - uses: actions/create-github-app-token@v1
        id: app-token
        with:
          app-id: \${{ secrets.GH_APP_ID }}
          private-key: \${{ secrets.GH_APP_PRIVATE_KEY }}
        continue-on-error: true
      - name: Download outputs
        uses: actions/download-artifact@v4
        with:
          name: agent-test-agent-outputs-\${{ github.run_id }}
          path: /tmp/outputs/
        continue-on-error: true
      - name: Execute outputs
        run: bun run repo-agent run outputs --agent "Test Agent"
        env:
          GH_TOKEN: \${{ steps.app-token.outputs.token || secrets.GITHUB_TOKEN }}
          EVENT_PAYLOAD: \${{ needs.dispatcher.outputs.agent-test-agent-event-payload }}

  agent-test-agent-audit:
    runs-on: ubuntu-latest
    needs:
      - dispatcher
      - agent-test-agent
    if: always() && needs.dispatcher.outputs.agent-test-agent-should-run == 'true'
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - uses: actions/create-github-app-token@v1
        id: app-token
        with:
          app-id: \${{ secrets.GH_APP_ID }}
          private-key: \${{ secrets.GH_APP_PRIVATE_KEY }}
        continue-on-error: true
      - name: Download audit metrics
        uses: actions/download-artifact@v4
        with:
          name: agent-test-agent-audit-\${{ github.run_id }}
          path: /tmp/artifacts/
        continue-on-error: true
      - name: Generate audit report
        run: bun run repo-agent run audit --agent "Test Agent"
        env:
          GH_TOKEN: \${{ steps.app-token.outputs.token || secrets.GITHUB_TOKEN }}
          AGENT_RESULT: \${{ needs.agent-test-agent.result }}
"
`;
